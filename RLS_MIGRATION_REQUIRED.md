# โ๏ธ CRITICAL: Apply RLS Migration to Supabase

## ุงููุดููุฉ ุงูุญุงููุฉ:
ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุญุชุงุฌ ุงูู RLS migration ูุชุดุชุบู ุตุญ. ุจุฏูู ูุฐุง:
- โ ูู ุงูุชููุงูุชุณ ุชุฑู ููุณ ุงูุจูุงูุงุช
- โ ูุณุชุฎุฏููู ุฌุฏุฏ ูุง ููุฏุฑูู ููุดุฆูุง profiles
- โ 406 errors ุนูุฏ ูุญุงููุฉ ุฌูุจ user_profiles

## โ ุงูุญู:

### ุฎุทูุฉ 1: ุงูุชุญ Supabase
1. ุงุฐูุจ ุฅูู https://app.supabase.com
2. ุงุฎุชุฑ ูุดุฑูุนู

### ุฎุทูุฉ 2: ุงูุชุญ SQL Editor
1. ุงุถุบุท **SQL Editor** ูู ุงููุงุฆูุฉ ุงููุณุฑู
2. ุงุถุบุท **New Query**

### ุฎุทูุฉ 3: ูุณุฎ Migration
ุงูุชุญ ุงูููู:
```
supabase/migrations/20260208_fix_rls_circular_dependency.sql
```

ุงูุณุฎ **ูู ุงููุญุชูู** (ุฌููุน ุงูุฃุณุทุฑ ูู 1 ุฅูู 284)

### ุฎุทูุฉ 4: ุงูุตู ูู Supabase
1. ุงูุตู ุงููุญุชูู ูู SQL Editor
2. ุงุถุบุท **Run** (ุฃู Ctrl+Enter)

### ุฎุทูุฉ 5: ุชุฃูุฏ ูู ุงููุฌุงุญ
ูุฌุจ ุชุดูู ุฑุณุงูุฉ "Query executed successfully" ุจุฏูู ุฃุฎุทุงุก

---

## ๐ ูุง ุชูุนูู ุงูู Migration:

1. **ุชุญุฐู ุงูู RLS policies ุงููุฏููุฉ ุงููุณุฑู**
2. **ุชุญุฐู ุงูู function ุงููุฏููุฉ** (`current_tenant_id()`) ุงูุชู ุชุณุจุจ circular dependency
3. **ุชูุดุฆ function ุฌุฏูุฏุฉ** (`get_current_tenant_id()`) ูุน `SECURITY DEFINER` (ุงูุตุญ)
4. **ุชุนูุฏ ุฅูุดุงุก ูู ุงูู RLS policies** ุจุงูุทุฑููุฉ ุงูุตุญ

---

## โจ ุงููุชูุฌุฉ ุจุนุฏ ุงูุชุทุจูู:

โ ูู tenant ุชุฑู ุจูุงูุงุช ุงูู tenant ุจุชุงุนุชู ุจุณ  
โ ูุญูู ูู data leakage ุจูู ุงูุชููุงูุชุณ  
โ ูุณุชุฎุฏููู ุฌุฏุฏ ููุฏุฑูู ููุดุฆูุง profiles ุจุฏูู ูุดุงูู  
โ ูุง ูุฒูุฏ 406 errors  

---

## ๐ ูู ุญุฏุซ ุฎุทุฃ:

1. **"Function does not exist"** โ ูููุณุ ูุฐุง ูุนูุงู ุชูุญุฐู ุงููุฏููุฉ ุฃููุงู
2. **"Permission denied"** โ ุชุฃูุฏ ุฃูู logged in ูู admin ูู Supabase
3. **"Syntax error"** โ ุชุฃูุฏ ุฃูู ูุณุฎุช ูู ุงูููู ุงูุตุญูุญ

ุงุชุตู ุฅุฐุง ุงุญุชุฌุช ูุณุงุนุฏุฉ!
